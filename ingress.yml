.combined-ingress:
  # this is a way to ensure only one copy of this job will run at a time.
  stage: build
  resource_group: combined-ingress
  variables:
    version: 0.0.4
    image: mozmeao/combinedingress
    GIT_STRATEGY: clone
    port: 80
    branch_prefix: demo/
    service: library
    domain: example.com
  tags:
    - oregon-b-shell
  script:
    - mkdir output
    - git fetch --all
    - docker pull $image:$version
    - docker run -v $(pwd)/output:/output -v $(pwd):/repo $image:$version $service $port $domain $branch_prefix
    - cat output/*
